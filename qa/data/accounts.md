# Test Accounts Documentation

**Last Updated:** 2025-01-17

This document describes the test accounts used across the TokenMetric testing infrastructure.

## Warning

**These accounts are for testing purposes only. Never use real funds with these addresses.**

---

## Test Accounts

### Manager Accounts

| Name | Address | Private Key | Purpose |
|------|---------|--------------|---------|
| manager | `0x7fa3...c2e` | `0x...(test only)` | Admin operations |
| deployer | `0x3C44...16D` | `0x...(test only)` | Contract deployments |

### User Accounts

| Name | Address | Initial Balance | Purpose |
|------|---------|---------------|---------|
| user1 | `0xabc1...111` | 1,000,000 USDC | Deposit testing |
| user2 | `0xdef2...222` | 1,000,000 USDC | Withdrawal testing |
| user3 | `0x333...333` | 1,000,000 USDC | Multi-user scenarios |
| attacker | `0x9999...999` | 1,000,000 USDC | Security/fuzz testing |

## Foundry Test Addresses

These addresses are generated by Foundry during test execution:

- `manager`: Generated via `makeAddr("manager")`
- `user1`: Generated via `makeAddr("user1")`
- `user2`: Generated via `makeAddr("user2")`
- `attacker`: Generated via `makeAddr("attacker")`

## Account Permissions

### Manager Permissions
- Add/remove protocols
- Allocate/deallocate funds
- Process withdrawals
- Collect yield
- Emergency functions
- Set manager

### User Permissions
- Deposit funds
- Request withdrawals
- Cancel own withdrawals
- Instant withdraw (subject to limits)

## Seeding Testnet Wallets

### Method 1: Using Foundry Cast

```bash
# Create and fund accounts on testnet
cast send 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 \
  --value 1ether \
  --private-key $TEST_PRIVATE_KEY
```

### Method 2: Using Faucet

```bash
# Use a testnet faucet
curl -X POST https://faucet.quicknode.com/ethereum/goerli/0xabc1111111111111111111111111111111111111
```

### Method 3: Using Script

```bash
# Run the seed script
python qa/scripts/seed_testnet_wallets.py
```

## Environment-Specific Accounts

### Local Development (Anvil)

Local Anvil uses deterministic addresses based on private key index:

```solidity
address(0) // 0x7fa3252c0948d6fb5cc06ca5161e2eb6f0b9c2e
address(1) // 0x...
```

### Goerli Testnet

Use testnet faucet to fund accounts before testing.

### Mainnet Forking

```bash
# Fork mainnet for testing
anvil --fork-url $MAINNET_RPC_URL
```

## Token Addresses

### Mock Tokens (Local)

Deployed during test setup:
- MockUSDC: Deployed by VaultFixture
- Mock Protocol: Deployed per test

### Real Tokens (Testnet)

- USDC: `0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48` (Goerli)
- USDC: `0x07865c6E87B9220b102C120a46c2e2F92d5C8402` (Sepolia)

## Contract Addresses

### Deployed Contracts

| Contract | Address | Notes |
|----------|---------|-------|
| TMVault | Deployed per test | Mock vault |
| MockUSDC | Deployed per test | Mock USDC |
| MockProtocolA | Deployed per test | Mock protocol A |
| MockProtocolB | Deployed per test | Mock protocol B |

## Key Management

### Private Keys (Test Only!)

```
# NEVER commit real private keys
Manager: 0xac0974bec39a17e36ba4a6b4d238ff944bacb478c... # Test only!
```

### Environment Variables

```bash
# .env.test
PRIVATE_KEY=0x... # Test private key
MANAGER_ADDRESS=0x7fa3...
RPC_URL=http://localhost:8545
```

## Funding Test Accounts

### Automatic Funding

The VaultFixture automatically funds test accounts:

```solidity
function setUp() public virtual {
    usdc.mint(user1, 1_000_000e6);
    usdc.mint(user2, 1_000_000e6);
}
```

### Manual Funding

```bash
# Mint USDC to test account
cast send <MOCK_USDC_ADDRESS> \
  "mint(address(user1), 1000000e6)" \
  --private-key $TEST_KEY
```

## Security Considerations

### Key Derivation

Test accounts use predictable addresses for reproducibility:

```solidity
// Predictable test addresses
manager = makeAddr("manager"); // 0x...manager
user1 = makeAddr("user1");     // 0x...user1
```

### Address Collision Prevention

- Never reuse test addresses on mainnet
- Always use deterministic test addresses in CI/CD
- Rotate test keys if accidentally exposed

## Account Lifecycle

### Creation
1. Generate address (makeAddr / vanitygen)
2. Fund with test tokens
3. Configure allowances

### Reset
```bash
# Reset all test state
./qa/scripts/reset_env.sh --hard
```

### Seed
```bash
# Seed fresh test data
python qa/scripts/seed_test_data.py
```

## Quick Reference

### Foundry Cheatsheet

```bash
# Create address
makeAddr("label")

# Get balance
usdc.balanceOf(address)

# Mint tokens
usdc.mint(address, amount)

# Deallocation
vm.prank(address); usdc.transfer(to, amount)
```

### Testing Commands

```bash
# Run all tests
forge test

# Run specific test
forge test --match-test test_Deposit

# Run with traces
forge test -vvvv

# Get coverage
forge coverage
```
